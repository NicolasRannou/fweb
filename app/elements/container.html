<link rel="import" href="../bower_components/polymer-ui-elements/elements.html">

<link rel="import" href="home.html">
<link rel="import" href="research.html">
<link rel="import" href="team.html">
<link rel="import" href="contact.html">

<polymer-element name="container-element"  attributes="">
  <template>
    <link rel="stylesheet" href="../bower_components/font-awesome/css/font-awesome.min.css">
    <style>
      @host { :scope {display: block;} }
      [main] {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
      [navigation] {
        width: 256px;
        height: 100%;
      }

      [tool] {
        display: -webkit-flex;
      -webkit-flex-direction: row;

      display: flex;
      flex-direction: row;height:100% !important;
      justify-content: center;
      }
      #main {
        overflow-y:scroll;
        margin-right: -20px;
      }
      polymer-ui-submenu-item{
        margin-top: -1px;
        border-top: 1px black solid;
        border-bottom: 1px black solid;
      }

      polymer-ui-submenu-item #menu{
        margin-left: 5px;
      }

      span.icon, polymer-ui-submenu-item.icon::before{
        font-weight: normal;
        font-family: "FontAwesome";
      }


      .contact{
        color: #08C
      }
      polymer-ui-submenu-item.contact::before{
        content:"\f02D";
      }
      .home{
        color: #BA55D3;
      }
      polymer-ui-submenu-item.home::before{
        content:"\f015";
      }
      .team{
        color: #08B8B8;
      }
      polymer-ui-submenu-item.team::before
{        content:"\f0c0";
      }
      .research{
        color: #0DA861
      }
      polymer-ui-submenu-item.research::before{
        content:"\f0c3";
      }
     
      polymer-ui-submenu-item  polymer-ui-menu-item{
        display:inline-block !important;
        min-width:60%
      }

      polymer-ui-menu-item:hover{
        background-color:#888
      }

      div polymer-ui-toolbar span {
        padding: 0 100px;
      }

      polymer-ui-menu {
        font-weight:normal;
        padding:0;
      }

      polymer-ui-menu-item {
        padding:0;
      }

      .enveloppe{
        height:100%;
        padding: 0 10px;
        border-right: 1px solid #FFF;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -moz-align-items: center;
        -webkit-align-items: center;
        align-items: center;
/*        display: flex !important;*/
display:none;
        border-right:1px solid;
        padding:0 10px;


      }

      .enveloppe{
-webkit-transition: -webkit-text-shadow 300ms ease;
    -moz-transition: -moz-text-shadow 300ms ease;
    -o-transition: -o-text-shadow 300ms ease;
    transition: text-shadow  300ms ease;


      }

      .envP-selected{
/*        background: rgb(0, 157, 233);
#009DE9
*/
                text-shadow: 0 0 10px #FFF; /* horizontal-offset vertical-offset 'blur' colour */
        -moz-text-shadow: 0 0 10px #FFF;
        -webkit-text-shadow: 0 0 10px #FFF;
      }


      .navTopLink{
        -webkit-box-align: center;
-ms-flex-align: center;
-moz-align-items: center;
-webkit-align-items: center;
align-items: center;display: flex !important; padding:0 10px;
        height:100%;
      }

      #topNav{
        align-items: center;display: flex !important;
                height:100%;

      }

            .navTopLink:hover{
background:lightgrey;
color: #000;
cursor: pointer;
      }

      .navTopMenu{
display: -webkit-flex;
      -webkit-flex-direction: row;

      display: flex;
      flex-direction: row;
      }

      #envS2{
/*        position: fixed;
bottom: 100px;
height: 60px;
z-index: 15;
right: 10px;*/
      }

            .eightNav{
        position: fixed;
top: 70px;
z-index: 15;
right: 10px;
        border-right:1px solid;
        background-color: rgba(0, 0, 0, 0.8);

      }

      .section-selected{
        border-left: 4px solid white;
        padding-right: 9px;
                padding-top: 9px;        padding-bottom: 9px;
padding-left: 5px!important;
color:white;
      }

            .page-selected{
        background:#FFF;
color:#353535;
      }

      .section-right{
               padding:9px; 
      }

      .section-right:hover{
        cursor:pointer;
        background: lightgrey;
      }

      polymer-ui-toolbar.polymer-ui-dark-theme{
        background-color: rgb(0, 0, 0)!important;
      }

#rightNav{
  border: 1px solid rgb(63, 63, 63);
margin-right: -1px;
padding: 10px;
}
    </style>
  <polymer-ui-scaffold3 theme="polymer-ui-dark-theme" style="height:100%;position: relative;">



      <div tool flex>
        <div id="topNav">
             <template repeat="{{ pages }}">
                      <div class="navTopLink {{page}}-top page-top" on-tap="{{horizontalMenu}}">{{page}}</div>

            </template>
          </div>

            <div id="rightNav" class="eightNav" style="color:black;">
            <div id="right-container-home" class="right-container">
              <template repeat="{{ home }}">
                <div class="home {{section}}-right section-right" on-tap="{{verticalMenu}}">{{section}}</div>
              </template>
            </div>
            <div id="right-container-research" class="right-container" style="display:none">
             <template repeat="{{ research }}">
                <div class="research {{section}}-right section-right" on-tap="{{verticalMenu}}">{{section}}</div>
              </template>
            </div>
            <div id="right-container-team" class="right-container" style="display:none">
              <template repeat="{{ team }}">
                <div class="team {{section}}-right section-right" on-tap="{{verticalMenu}}">{{section}}</div>
              </template>
            </div>
            <div id="right-container-contact" class="right-container" style="display:none">
              <template repeat="{{ contact }}">
                <div class="contact {{section}}-right section-right" on-tap="{{verticalMenu}}">{{section}}</div>
              </template>
            </div>
          </div>

        <polymer-ui-toolbar class="navTopMenu" responsive>

          <!-- page navigation -->
           <span id="envP" class="enveloppe">
          <polymer-ui-menu-button id="page-topnav" label="{{previousPage}}" selected="{{pageIndexTop}}" >
            <template repeat="{{ pages }}">
              <polymer-ui-menu-item class="{{page}} icon" title="{{page}}" label="{{page}}"></polymer-ui-menu-item>
            </template>
          </polymer-ui-menu-button>
          </span>

          <!-- section navigation -->

          <!-- home section -->
          <span id="envS" class="enveloppe envS">
          <polymer-ui-menu-button id="home-topnav" label="{{homeSection}}" selected="{{homeIndexTop}}">
            <template repeat="{{ home }}">
              <polymer-ui-menu-item on-tap="{{jump}}" title="home" label="{{section}}"></polymer-ui-menu-item>
            </template>
          </polymer-ui-menu-button>

          <!-- research section -->
         <polymer-ui-menu-button id="research-topnav" label="{{researchSection}}" selected="{{researchIndexTop}}" style="display:none">
            <template repeat="{{ research }}">
              <polymer-ui-menu-item on-tap="{{jump}}" title="research" label="{{section}}"></polymer-ui-menu-item>
            </template>
          </polymer-ui-menu-button>

          <!-- team section -->
          <polymer-ui-menu-button id="team-topnav" label="{{teamSection}}" selected="{{teamIndexTop}}" style="display:none">
            <template repeat="{{ team }}">
              <polymer-ui-menu-item on-tap="{{jump}}" title="team" label="{{section}}"></polymer-ui-menu-item>
            </template>
          </polymer-ui-menu-button>

          <!-- contact section -->
          <polymer-ui-menu-button id="contact-topnav" label="{{contactSection}}" selected="{{contactIndexTop}}" style="display:none">
            <template repeat="{{ contact }}">
              <polymer-ui-menu-item on-tap="{{jump}}" title="contact" label="{{section}}"></polymer-ui-menu-item>
            </template>
          </polymer-ui-menu-button>
        </span>
 </polymer-ui-toolbar>
      </div>
           
      <div on-scroll="{{scroll}}" id="main" main>

        <!-- home element -->
        <home-element id="home" reloaded="{{homeReloaded}}" scrollToSection="{{homeScroll}}"  jumpToSection="{{homeJump}}" currentSection="{{homeSection}}" currentSectionIndex="{{homeIndexTop}}"></home-element>

        <!-- research element -->
        <research-element id="research" reloaded="{{researchReloaded}}" scrollToSection="{{researchScroll}}" jumpToSection="{{researchJump}}" currentSection="{{researchSection}}" currentSectionIndex="{{researchIndexTop}}" style="display:none;"></research-element>

        <!-- team element -->
        <team-element id="team" reloaded="{{teamReloaded}}" scrollToSection="{{teamScroll}}" jumpToSection="{{teamJump}}" currentSection="{{teamSection}}" currentSectionIndex="{{teamIndexTop}}" style="display:none;"></team-element>

        <!-- contact element -->
        <contact-element id="contact" reloaded="{{contactReloaded}}" scrollToSection="{{contactScroll}}" jumpToSection="{{contactJump}}" currentSection="{{contactSection}}" currentSectionIndex="{{contactIndexTop}}" style="display:none;"></contact-element>

      </div>

      <polymer-ui-sidebar-menu navigation label="Navigation" offscreen="basement" selectedItem="{{item}}" on-polymer-select="{{sidenav}}" selected="{{pageIndexSide}}">

        <!-- home section -->
        <polymer-ui-submenu-item class="home icon" title="home" label="Home" selected="{{homeIndexSide}}">
          <template repeat="{{ home }}">
            <polymer-ui-menu-item on-tap="{{jump}}" title="home" label="{{section}}"></polymer-ui-menu-item>
          </template>
        </polymer-ui-submenu-item>

        <!-- research section -->
        <polymer-ui-submenu-item class="research icon" title="research" label="Research" selected="{{researchIndexSide}}">
          <template repeat="{{ research }}">
            <polymer-ui-menu-item on-tap="{{jump}}" title="research" label="{{section}}"></polymer-ui-menu-item>
          </template>
        </polymer-ui-submenu-item>

        <!-- team section -->
        <polymer-ui-submenu-item class="team icon" title="team" label="Team" selected="{{teamIndexSide}}">
          <template repeat="{{ team }}">
            <polymer-ui-menu-item on-tap="{{jump}}" title="team" label="{{section}}"></polymer-ui-menu-item>
          </template>
        </polymer-ui-submenu-item>

        <!-- contact section -->
        <polymer-ui-submenu-item class="contact icon" title="contact" label="Contact" selected="{{contactIndexSide}}">
          <template repeat="{{ contact }}">
            <polymer-ui-menu-item on-tap="{{jump}}" title="contact" label="{{section}}"></polymer-ui-menu-item>
          </template>
        </polymer-ui-submenu-item>

     </polymer-ui-sidebar-menu>
    </polymer-ui-scaffold3>

  </template>
  <script>
    Polymer('container-element', {
      ready: function() {
        // list the pages
        this.pages = [{page:'home', index:0},
                     {page:'research', index:1},
                     {page:'team', index:2},
                     {page:'contact', index:3}];

        // home page
        this.home = [{section:'welcome', index:0},
                     {section:'about', index:1},
                     {section:'research', index:2},
                     {section:'software', index:3}];
        this.initPageVars('home', this.home);

        // research page
        this.research = [{section:'magnetic resonance imaging', index:0},
                         {section:'near-infrared spectroscopy', index:1},
                         {section:'magnetoencephalography', index:2},
                         {section:'software development', index:3},
                         {section:'high-performace computing', index:4}];
        this.initPageVars('research', this.research);

        // team page
        this.team = [{section:'faculty', index:0},
                     {section:'staff', index:1},
                     {section:'collaborators', index:2},
                     {section:'alumni', index:3}];
        this.initPageVars('team', this.team);

        // contact page
        this.contact = [{section:'main', index:0},
                     {section:'autumn', index:1},
                     {section:'waltham', index:2}];
        this.initPageVars('contact', this.contact);

        // navigation
        this.previousPage =  'home';
        this.pageIndexTop = null;
        this.jumpReady = 0;
        this.pageIndexSide = null;

        $(this.$.envP).on(
    "transitionend MSTransitionEnd webkitTransitionEnd oTransitionEnd",
    function() {
        $(this).removeClass("envP-selected");
    }
);

        $(this.$.envS).on(
    "transitionend MSTransitionEnd webkitTransitionEnd oTransitionEnd",
    function() {
        $(this).removeClass("envP-selected");
    }
);

      },
      horizontalMenu: function(e, detail){
        var page = e.srcElement.innerHTML;

        // previous index: unselect it!
        $(this.$.topNav).find('.page-selected').removeClass("page-selected");
        $(this.$.topNav).find('.'+page+'-top').addClass("page-selected");

        var len = this.pages.length;
        while (len--) {

          if(this.pages[len].page == page){
            this.pageIndexTop = len;
            break;
          }
        }
      },
      verticalMenu: function(e, detail){
        // previous index: unselect it!
        if(this[this.previousPage+'IndexTop'] != null){
          $(this.$.rightNav).find('.section-selected').removeClass("section-selected");
        }

        $(this.$.rightNav).find('.'+this.previousPage+'.'+e.srcElement.innerHTML+'-right').addClass("section-selected");

        var len = this[this.previousPage].length;

        while (len--) {

          if(this[this.previousPage][len].section == e.srcElement.innerHTML){

            window.console.log(this[this.previousPage][len].section);
            window.console.log(this[this.previousPage+'IndexTop']);
                        window.console.log(this[this.previousPage+'Section']);
                                    window.console.log(this[this.previousPage+'Jump']);
                                                                        window.console.log(len);
            // update topnav
            this[this.previousPage+'IndexTop'] = len;
            this[this.previousPage+'Section'] = e.srcElement.innerHTML;

            // start jumping
            this.jumpReady = 0;
            this[this.previousPage+'Jump'] += 1;

            break;
          }
        }
      },
      initPageVars: function(pageName, pageObject){
        this[pageName+'Section'] = pageObject[0].section;
        this[pageName+'IndexTop'] =  null;
        this[pageName+'Jump'] = 0;
        this[pageName+'Scroll'] =0;
        this[pageName+'IndexSide'] = null;
        this[pageName+'Reload'] = 0;
      },
      jump: function(){
        this.jumpReady = 1;
      },
      scroll: function() {
        this[this.previousPage+'Scroll'] *= -1;
      },
      pageIndexTopChanged: function(){

      if(this.pageIndexTop != null){

        $(this.$.envP).toggleClass('envP-selected');

        // update topbar
        $(this.$.topNav).find('.page-selected').removeClass("page-selected");
        $(this.$.topNav).find('.'+this.pages[this.pageIndexTop].page+'-top').addClass("page-selected");

        // update rightbar
        $(this.$.rightNav).find('.right-container').hide();
        $(this.$.rightNav).find('#right-container-'+this.pages[this.pageIndexTop].page).show();


        // update sidebar
        // clean up previous page section in top nav!
        this[this.previousPage+'Section'] = this[this.previousPage][0].section ;
        this[this.previousPage+'IndexTop'] = null;

        // select page
        this.pageIndexSide = this.pageIndexTop;
        }
      },
      homeIndexTopChanged: function(){

      if(this.homeIndexTop != null){

        $(this.$.envS).toggleClass('envP-selected');

        // update rightbar
        $(this.$.rightNav).find('.section-selected').removeClass("section-selected");
        $(this.$.rightNav).find('.'+this.previousPage+'.'+this.home[this.homeIndexTop].section+'-right').addClass("section-selected");

        // update sidebar
        // select page
        this.pageIndexSide = 0;
        // select section
        this.homeIndexSide = this.homeIndexTop;
        }
      },
      researchIndexTopChanged: function(){

      if(this.researchIndexTop != null){

        $(this.$.envS).toggleClass('envP-selected');

        // update rightbar
        $(this.$.rightNav).find('.section-selected').removeClass("section-selected");
        $(this.$.rightNav).find('.'+this.previousPage+'.'+this.research[this.researchIndexTop].section+'-right').addClass("section-selected");

        // update sidebar
        // select page
        this.pageIndexSide = 1;
        // select section
        this.researchIndexSide = this.researchIndexTop;
        }
      },
      teamIndexTopChanged: function(){

      if(this.teamIndexTop != null){

        $(this.$.envS).toggleClass('envP-selected');

        // update rightbar
        $(this.$.rightNav).find('.section-selected').removeClass("section-selected");
        $(this.$.rightNav).find('.'+this.previousPage+'.'+this.team[this.teamIndexTop].section+'-right').addClass("section-selected");

        // update sidebar
        // select page
        this.pageIndexSide = 2;
        // select section
        this.teamIndexSide = this.teamIndexTop;
        }
      },
      contactIndexTopChanged: function(){

      if(this.contactIndexTop != null){

        $(this.$.envS).toggleClass('envP-selected');

        // update rightbar
        $(this.$.rightNav).find('.section-selected').removeClass("section-selected");
        $(this.$.rightNav).find('.'+this.previousPage+'.'+this.contact[this.contactIndexTop].section+'-right').addClass("section-selected");

        // update sidebar
        // select page
        this.pageIndexSide = 3;
        // select section
        this.contactIndexSide = this.contactIndexTop;
        }
      },
      sidenav: function(e, detail){

        if(detail.isSelected){
          var selectedPage = detail.item.title;

          if(selectedPage != this.previousPage){
            // hide previous page
            this.$[this.previousPage].style.display = 'none';
            this.$[this.previousPage+'-topnav'].style.display = 'none';
            // clean up previous page section in top nav!
            this[this.previousPage+'Section'] = this[this.previousPage][0].section ;
            this[this.previousPage+'IndexSide'] = null;
            this[this.previousPage+'IndexTop'] = null;

            // show current page
            this.$[selectedPage].style.display = 'block';
            this.$[selectedPage+'-topnav'].style.display = 'block';

            // ignore the scroll event
            this[selectedPage+'Reloaded'] = 1;
            this.$.main.scrollTop = 0;

            // selected page index
            this.previousPage = selectedPage;
            var len = this.pages.length;

            while (len--) {

              if(this.pages[len].page == selectedPage){
                this.pageIndexTop = len;
                break;
              }
            }

          }
          else{
            // find index
            var len = this[selectedPage].length;

            while (len--) {

              if(this[selectedPage][len].section == detail.item.label){
                // update topnav
                this[this.previousPage+'IndexTop'] = len;
                this[this.previousPage+'Section'] = detail.item.label;

                // start jumping
                 if(this.jumpReady  == 1){
                  window.console.log("side JJUMP");
                    this.jumpReady = 0;
                    this[this.previousPage+'Jump'] = 1;
                 }
                break;
              }
            }
            
          }
        }
      }
    });
  </script>
</polymer-element>
